"use strict";function parse_cookies(){var cookies={};if(document.cookie&&document.cookie!==""){document.cookie.split(";").forEach(function(c){var m=c.trim().match(/(\w+)=(.*)/);if(m!==undefined){cookies[m[1]]=decodeURIComponent(m[2])}})}return cookies}function send(method,uri,content,onSuccess,onError,setUp){var req=new XMLHttpRequest();req.open(method,uri,true);if(setUp!==undefined){setUp(req)}req.onreadystatechange=function(){if(req.readyState!==4){return}if(req.status>=200&&req.status<300){onSuccess(req.status,req.responseText)}else{onError(req.status,req.responseText)}};if(method==="POST"){req.send(content)}else{req.send()}return req}function required(){var valid=true;var chk;var chk2;for(var _iterator=document.getElementsByTagName("input"),_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[Symbol.iterator]();;){if(_isArray){if(_i>=_iterator.length){break}chk=_iterator[_i++]}else{_i=_iterator.next();if(_i.done){break}chk=_i.value}if(chk.type=="radio"){var checked=false;for(var _iterator2=document.getElementsByName(chk.name),_isArray2=Array.isArray(_iterator2),_i2=0,_iterator2=_isArray2?_iterator2:_iterator2[Symbol.iterator]();;){if(_isArray2){if(_i2>=_iterator2.length){break}chk2=_iterator2[_i2++]}else{_i2=_iterator2.next();if(_i2.done){break}chk2=_i2.value}checked=checked||chk2.checked}if(!checked){valid=false;break}}}if(!valid){document.getElementById("submit-btn").setAttribute("disabled","disabled")}else{document.getElementById("submit-btn").removeAttribute("disabled")}}function getTimeRemaining(endtime){var t=Date.parse(endtime)-Date.parse(new Date());var seconds=Math.floor((t/1000)%60);var minutes=Math.floor((t/1000/60)%60);var hours=Math.floor((t/(1000*60*60))%24);var days=Math.floor(t/(1000*60*60*24));return{total:t,days:days,hours:hours,minutes:minutes,seconds:seconds}}function disableAnswering(){var chk;for(var _iterator3=document.getElementsByTagName("input"),_isArray3=Array.isArray(_iterator3),_i3=0,_iterator3=_isArray3?_iterator3:_iterator3[Symbol.iterator]();;){if(_isArray3){if(_i3>=_iterator3.length){break}chk=_iterator3[_i3++]}else{_i3=_iterator3.next();if(_i3.done){break}chk=_i3.value}if(chk.type=="radio"){chk.setAttribute("disabled","disabled")}}}function initializeClock(time){var endtime=new Date(Date.parse(new Date())+time*60*1000);var clockLabel=document.getElementById("clock-label");var clockBar=document.getElementById("clock-bar");function updateClock(){var t=getTimeRemaining(endtime);clockLabel.innerHTML=("0"+t.minutes).slice(-2)+":"+("0"+t.seconds).slice(-2);var percent=Math.round((time*60-t.minutes*60-t.seconds)/(time*60)*100);clockBar.setAttribute("style","width: "+percent+"%;");if(t.total<=0){var submit=document.getElementById("submit-btn");submit.setAttribute("disabled","disabled");if(submit.mDone==undefined){submit.mDone=true;submit.onclick()}}}updateClock();window.timeinterval=setInterval(updateClock,1000)}function disableClock(){clearInterval(window.timeinterval);var cl=document.getElementById("clock-label");if(cl!=null){cl.remove()}var cb=document.getElementById("clock-bar");if(cb!=null){cb.remove()}}var genericErrorHandler=function genericErrorHandler(status,request){alert("ERROR "+status+"\n"+request)};var withCSRF=function withCSRF(request){request.setRequestHeader("X-CSRF-Token",parse_cookies().Token);request.setRequestHeader("Content-Type","application/json; charset=utf8")};var nextChar=function nextChar(char){if(char=="A"){return "B"}else if(char=="B"){return "C"}else{return "D"}};var createElement=function createElement(type,id,className){var element=document.createElement(type);if(id!=undefined){element.id=id}if(className!=undefined){element.className=className}return element};window.onload=function(){var startTestBtn=document.getElementById("start-test-btn");startTestBtn.onclick=function(){startTestBtn.disabled="disabled";send("POST","/test-start","",function(_,response){var testData=JSON.parse(response);var intro=document.getElementById("intro");var root=intro.parentNode;root.removeChild(intro);generateView(testData,root,true);required();initializeClock(testData.time)},genericErrorHandler,withCSRF)}};function generateView(testData,root,submitAndClock){var wrapper=createElement("div","test");if(submitAndClock){var clockLabel=createElement("p","clock-label","clock");wrapper.appendChild(clockLabel);var clockBarWrapper=createElement("div",undefined,"clock-wrapper");var clockBar=createElement("div","clock-bar","clock");clockBarWrapper.appendChild(clockBar);wrapper.appendChild(clockBarWrapper)}else{var finishLabel=createElement("p","finish-label");finishLabel.innerText="Zakończyłeś test! Odpowiedziałeś poprawnie na "+testData.mark+"% pytań. Jest to "+(testData.mark>=80?"ponad 80%, czyli zaliczyłeś ten test. Gratulacje!":"poniżej 80%, czyli nie udało ci się zaliczyć testu.");var anotherLabel=createElement("p");anotherLabel.innerText="Poniżej znajdują się pytania, na które nie odpowiedziałeś poprawnie.";var buttonFinish=createElement("button");buttonFinish.innerText="Powrót do portalu";buttonFinish.onclick=function(){window.location="/account/details"};wrapper.appendChild(finishLabel);wrapper.appendChild(anotherLabel);wrapper.appendChild(buttonFinish)}var counter=1;var q;var a;for(var _iterator4=testData.questions,_isArray4=Array.isArray(_iterator4),_i4=0,_iterator4=_isArray4?_iterator4:_iterator4[Symbol.iterator]();;){if(_isArray4){if(_i4>=_iterator4.length){break}q=_iterator4[_i4++]}else{_i4=_iterator4.next();if(_i4.done){break}q=_i4.value}var qwrapper=createElement("div");var header=createElement("h4");header.innerHTML="Pytanie "+counter++;var question=createElement("p",undefined,"question");question.innerHTML=q.question;var awrapper=createElement("div",undefined,"answer-wrapper");var char="A";var isCorrected=false;var _loop=function _loop(){if(_isArray5){if(_i5>=_iterator5.length){return "break"}a=_iterator5[_i5++]}else{_i5=_iterator5.next();if(_i5.done){return "break"}a=_i5.value}var isolator=document.createElement("div");var id=q.id+":"+a.id;if(submitAndClock){var radio=createElement("input",id);radio.type="radio";radio.value=a.id;radio.name=q.id;radio.onchange=function(){send("POST","/test-answer",JSON.stringify({q:radio.name,a:radio.value}),function(){},genericErrorHandler,withCSRF);required()};isolator.appendChild(radio)}var label=document.createElement("label");label.for=id;label.innerHTML=(a.correct?'<span class="red bold">':"")+char+". "+(a.correct?"</span>":"")+a.answer;if(submitAndClock){label.onclick=function(){return document.getElementById(id).click()}}char=nextChar(char);if(a.correct){isCorrected=true}isolator.appendChild(label);awrapper.appendChild(isolator)};for(var _iterator5=q.answers,_isArray5=Array.isArray(_iterator5),_i5=0,_iterator5=_isArray5?_iterator5:_iterator5[Symbol.iterator]();;){var _ret=_loop();if(_ret==="break"){break}}qwrapper.appendChild(header);qwrapper.appendChild(question);qwrapper.appendChild(awrapper);if(isCorrected){var info=createElement("p",undefined,"question-info");info.innerHTML=q.information;qwrapper.appendChild(info)}wrapper.appendChild(qwrapper)}if(submitAndClock){var submit=createElement("button","submit-btn");submit.type="submit";submit.innerText="Zakończ test";submit.onclick=function(){var go=true;if(submit.mDone==undefined){go=confirm("Jesteś pewny?")}if(go){submit.mDone=true;disableAnswering();disableClock();submit.setAttribute("disabled","disabled");send("POST","/test-finish","",function(status,response){var testData=JSON.parse(response);wrapper.remove();generateView(testData,root,false);document.scrollingElement.scrollTop=0},genericErrorHandler,withCSRF)}};wrapper.appendChild(submit)}root.appendChild(wrapper)}