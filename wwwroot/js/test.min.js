function parse_cookies(){var cookies={};return document.cookie&&""!==document.cookie&&document.cookie.split(";").forEach(function(c){var m=c.trim().match(/(\w+)=(.*)/);void 0!==m&&(cookies[m[1]]=decodeURIComponent(m[2]))}),cookies}function send(method,uri,content,onSuccess,onError,setUp){var req=new XMLHttpRequest;return req.open(method,uri,!0),void 0!==setUp&&setUp(req),req.onreadystatechange=function(){4===req.readyState&&(req.status>=200&&req.status<300?onSuccess(req.status,req.responseText):onError(req.status,req.responseText))},"POST"===method?req.send(content):req.send(),req}function required(){let valid=!0;for(chk of document.getElementsByTagName("input"))if("radio"==chk.type){let checked=!1;for(chk2 of document.getElementsByName(chk.name))checked=checked||chk2.checked;if(!checked){valid=!1;break}}valid?document.getElementById("submit-btn").removeAttribute("disabled"):document.getElementById("submit-btn").setAttribute("disabled","disabled")}function getTimeRemaining(endtime){var t=Date.parse(endtime)-Date.parse(new Date),seconds=Math.floor(t/1e3%60),minutes=Math.floor(t/1e3/60%60),hours=Math.floor(t/36e5%24),days;return{total:t,days:Math.floor(t/864e5),hours:hours,minutes:minutes,seconds:seconds}}function disableAnswering(){for(chk of document.getElementsByTagName("input"))"radio"==chk.type&&chk.setAttribute("disabled","disabled")}function initializeClock(time){let endtime=new Date(Date.parse(new Date)+60*time*1e3);var clockLabel=document.getElementById("clock-label"),clockBar=document.getElementById("clock-bar");function updateClock(){var t=getTimeRemaining(endtime);clockLabel.innerHTML=("0"+t.minutes).slice(-2)+":"+("0"+t.seconds).slice(-2);let percent=Math.round((60*time-60*t.minutes-t.seconds)/(60*time)*100);if(clockBar.setAttribute("style","width: "+percent+"%;"),t.total<=0){let submit=document.getElementById("submit-btn");submit.setAttribute("disabled","disabled"),null==submit.mDone&&(submit.mDone=!0,submit.onclick())}}updateClock(),window.timeinterval=setInterval(updateClock,1e3)}function disableClock(){clearInterval(window.timeinterval);let cl=document.getElementById("clock-label");null!=cl&&cl.remove();let cb=document.getElementById("clock-bar");null!=cb&&cb.remove()}let genericErrorHandler=(status,request)=>{alert("ERROR "+status+"\n"+request)},withCSRF=request=>{request.setRequestHeader("X-CSRF-Token",parse_cookies().Token),request.setRequestHeader("Content-Type","application/json; charset=utf8")},nextChar=char=>"A"==char?"B":"B"==char?"C":"D",createElement=(type,id,className)=>{let element=document.createElement(type);return null!=id&&(element.id=id),null!=className&&(element.className=className),element};function generateView(testData,root,submitAndClock){let wrapper=createElement("div","test");if(submitAndClock){let clockLabel=createElement("p","clock-label","clock");wrapper.appendChild(clockLabel);let clockBarWrapper=createElement("div",void 0,"clock-wrapper"),clockBar=createElement("div","clock-bar","clock");clockBarWrapper.appendChild(clockBar),wrapper.appendChild(clockBarWrapper)}else{let finishLabel=createElement("p","finish-label");finishLabel.innerText="Zakończyłeś test! Odpowiedziałeś poprawnie na "+testData.mark+"% pytań. Jest to "+(testData.mark>=80?"ponad 80%, czyli zaliczyłeś ten test. Gratulacje!":"poniżej 80%, czyli nie udało ci się zaliczyć testu.");let anotherLabel=createElement("p");anotherLabel.innerText="Poniżej znajdują się pytania, na które nie odpowiedziałeś poprawnie. Zaznaczone są twoje odpowiedzi, a pod nimi jest podpowiedź, gdzie w rulebooku znajdziesz te informacje.";let buttonFinish=createElement("button");buttonFinish.innerText="Powrót do portalu",buttonFinish.onclick=(()=>{window.location="/account/details"}),wrapper.appendChild(finishLabel),wrapper.appendChild(anotherLabel),wrapper.appendChild(buttonFinish)}let counter=1;for(q of testData.questions){let qwrapper=createElement("div"),header=createElement("h4");header.innerHTML="Pytanie "+counter++;let question=createElement("p",void 0,"question");question.innerHTML=q.question;let awrapper=createElement("div",void 0,"answer-wrapper"),char="A",isCorrected=!1;for(a of q.answers){let isolator=document.createElement("div"),id=q.id+":"+a.id;if(submitAndClock){let radio=createElement("input",id);radio.type="radio",radio.value=a.id,radio.name=q.id,radio.onchange=(()=>{send("POST","/test-answer",JSON.stringify({q:radio.name,a:radio.value}),()=>{},genericErrorHandler,withCSRF),required()}),isolator.appendChild(radio)}let label=document.createElement("label");label.for=id,label.innerHTML=(a.correct?'<span class="red bold">':"")+char+". "+(a.correct?"</span>":"")+a.answer,submitAndClock&&(label.onclick=(()=>document.getElementById(id).click())),char=nextChar(char),a.correct&&(isCorrected=!0),isolator.appendChild(label),awrapper.appendChild(isolator)}if(qwrapper.appendChild(header),qwrapper.appendChild(question),qwrapper.appendChild(awrapper),isCorrected){let info=createElement("p",void 0,"question-info");info.innerHTML=q.information,qwrapper.appendChild(info)}wrapper.appendChild(qwrapper)}if(submitAndClock){let submit=createElement("button","submit-btn");submit.type="submit",submit.innerText="Zakończ test",submit.onclick=(()=>{let go=!0;null==submit.mDone&&(go=confirm("Jesteś pewny?")),go&&(submit.mDone=!0,disableAnswering(),disableClock(),submit.setAttribute("disabled","disabled"),send("POST","/test-finish","",(status,response)=>{let testData=JSON.parse(response);wrapper.remove(),generateView(testData,root,!1),document.scrollingElement.scrollTop=0},genericErrorHandler,withCSRF))}),wrapper.appendChild(submit)}root.appendChild(wrapper)}window.onload=function(){var startTestBtn=document.getElementById("start-test-btn");startTestBtn.onclick=(()=>{startTestBtn.disabled="disabled",send("POST","/test-start","",(_,response)=>{let testData=JSON.parse(response),intro=document.getElementById("intro"),root=intro.parentNode;root.removeChild(intro),generateView(testData,root,!0),required(),initializeClock(testData.time)},genericErrorHandler,withCSRF)})};